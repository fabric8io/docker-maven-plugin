
[[build-configuration]]
=== Configuration

All build relevant configuration is contained in the `<build>` section
of an image configuration. In addition to `<dockerFileDir>` and
`<dockerFile>` the following configuration options are available:

.Build configuration
[cols="1,5"]
|===
| Element | Description

| *args*
| Map specifying the value of https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables-build-arg[Docker build args]
which should be used when building the image with an external Dockerfile which uses build arguments. The key-value syntax is the same as when defining Maven properties (or `labels` or `env`).
This argument is ignored when no external Dockerfile is used. Build args can also be specified as properties as
described in <<build-buildargs,Build Args>>

| *assembly*
| specifies the assembly configuration as described in <<build-assembly,Build Assembly>>

| *cleanup*
| Cleanup dangling (untagged) images after each build (including any containers created from them). Default is `try` which tries to remove the old image, but doesn't fail the build if this is not possible because e.g. the image is still used by a running container. Use `remove` if you want to fail the build and `none` if no cleanup is requested.

| *nocache*
| Don't use Docker's build cache. This can be overwritten by setting a system property `docker.nocache` when running Maven.

| *cmd*
| A command to execute by default (i.e. if no command is provided when a container for this image is started). See <<misc-startup,Startup Arguments>> for details.

| *entryPoint*
| An entrypoint allows you to configure a container that will run as an executable. See <<misc-startup,Startup Arguments>> for details.

| *env*
| The environments as described in <<misc-env,Setting Environment Variables and Labels>>.

| *from*
| The base image which should be used for this image. If not given this default to `busybox:latest` and is suitable for a pure data image.

| *labels*
| Labels  as described in <<misc-env,Setting Environment Variables and Labels>>.

| *maintainer*
| The author (`MAINTAINER`) field for the generated image

| *ports*
| The exposed ports which is a list of `<port>` elements, one for each port to expose.

| *runCmds*
| Commands to be run during the build process. It contains *run* elements which are passed to the shell. The run commands are inserted right after the assembly and after *workdir* in to the Dockerfile. This tag is not to be confused with the `<run>` section for this image which specifies the runtime behaviour when starting containers.

| *optimise*
| if set to true then it will compress all the `runCmds` into a single `RUN` directive so that only one image layer is created.

| *compression*
| The compression mode how the build archive is transmitted to the docker daemon (`{plugin}:build`) and how docker build archives are attached to this build as sources (`{plugin}:source`). The value can be `none` (default), `gzip` or `bzip2`.

| *skip*
| if set to true disables building of the image. This config option is best used together with a maven property

| *tags*
| List of additional `tag` elements with which an image is to be tagged after the build.

| *user*
| User to which the Dockerfile should switch to the end (corresponds to the `USER` Dockerfile directive).

| *volumes*
| List of `volume` elements to create a container volume.

| *workdir*
| Directory to change to when starting the container.
|===

From this configuration this Plugin creates an in-memory Dockerfile,
copies over the assembled files and calls the Docker daemon via its
remote API.

.Example
[source,xml]
----
<build>
  <from>java:8u40</from>
  <maintainer>john.doe@example.com</maintainer>
  <tags>
    <tag>latest</tag>
    <tag>${project.version}</tag>
  </tags>
  <ports>
    <port>8080</port>
  </ports>
  <volumes>
    <volume>/path/to/expose</volume>
  </volumes>

  <entryPoint>
    <!-- exec form for ENTRYPOINT -->
    <exec>
      <arg>java</arg>
      <arg>-jar</arg>
      <arg>/opt/demo/server.jar</arg>
    </exec>
  </entryPoint>

  <assembly>
    <mode>dir</mode>
    <basedir>/opt/demo</basedir>
    <descriptor>assembly.xml</descriptor>
  </assembly>
</build>
----

In order to see the individual build steps you can switch on `verbose` mode either by setting the property `docker.verbose` or by using `<verbose>true</verbose>` in the <<global-configuration,Global configuration>>
